<tool id="data_manager_clair3_models" name="Clair3 model downloader" version="0.0.1" tool_type="manage_data" profile="23.2" />
    <requirements>
        <requirement type="package">python</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        python '$tool_directory/model_fetcher.py'
            '{output_file}'
            #if $model_selection.source == 'latest'
                --download_latest
            #elif $model_selection.source == 'chosen'
                --model_list '$model_selection.model_list'
            #end if
    ]]></command>
    <inputs>
        <conditional name="model_selection">
            <param name="source" label="Select the source of the list of models to download" type="select">
                <option value="latest">Latest models from rerio page</option>
                <option value="chosen">User provided list of models</option>
            </param>
        <when value="latest">
        </when>
        <when value="chosen">
            <param name="model_list" type="text" label="List of models to download" help="A space separated list of model to download, e.g. 'r1041_e82_400bps_sup_v430,r1041_e82_400bps_hac_v430'">
                <validator type="regex" message="Invalid model list. Format is a space separated list of model names (e.g. 'r1041_e82_400bps_sup_v430,r1041_e82_400bps_hac_v430')" value="^[a-z_0-9,]+$"/>
            </param>
    </inputs>
    <outputs>
        <data name="output_file" format="data_manager_clair3_models" label="Downloaded models" />
    </outputs>
    <tests>
        <test> <!-- test1 -->
            <conditional name="model_selection">
                <param name="source" value="chosen"/>
                <param name="model_list" value="r1041_e82_400bps_sup_v500,r1041_e82_400bps_hac_v500" />
            </conditional>
            <output name="output_file">
                <assert_contents>
                    <has_text text='r1041_e82_400bps_sup_v500' />
                </assert_contents>
            </output>
        </test>
        <test> <!-- test2 -->
            <conditional name="model_selection">
                <param name="source" value="latest"/>
            </conditional>
            <output name="output_file">
                <assert_contents>
                    <!-- because we don't know what the names of the latest models are we can only test to see if the data table output is created -->
                    <has_text text='data_tables' />  
                </assert_contents>
            </output>
    </tests>
</tool>