<tool id="pcdl_make_gif" name="pcdl_make_gif" version="3.0.1+galaxy0" profile="21.05">
    <macros>
        <import>pcdl_macros.xml</import>
    </macros>

    <requirements>
        <requirement type="package" version="3.3.7">pcdl</requirement>
    </requirements>

    <stdio> <exit_code range=":" level="log" description="hello world!"/> </stdio>
    <command><![CDATA[
        #import re
        mkdir timeseries &&
        #for $file in $path:
            #set $filename = re.sub('[^\w\-\.\s]', '_', str($file.element_identifier))
            ln -s '$file' timeseries/$filename &&
        #end for

        pcdl_make_gif 'timeseries' $interface
    ]]></command>

    <inputs>
        <section name="essential" title="essential:" expanded="true">
            <expand macro="path" />
            <expand macro="interface" />
        </section>
    </inputs>

    <outputs>
        <collection name="timeseries_gif" type="list">
            <discover_datasets pattern="(?P&lt;designation&gt;timeseries_.+)\.gif" format="gif" directory="timeseries" visible="false" />
        </collection>
    </outputs>

    <tests>
        <test expect_num_outputs="1">
            <section name="essential">
                <param name="path">
                    <collection type="list">
                        <element name="output00000000_oxygen.jpeg" value="output00000000_oxygen.jpeg" />
                        <element name="output00000001_oxygen.jpeg" value="output00000001_oxygen.jpeg" />
                    </collection>
                </param>
                <param name="interface" value="jpeg" />
            </section>
            <output_collection name="timeseries_gif" count="1">
                 <element name="timeseries_jpeg" file="timeseries_jpeg.gif" ftype="gif" />
            </output_collection>
        </test>
    </tests>

    <help><![CDATA[
this function generates a gif movie from all image files found in the data collection in the specified interface file format.

homepage: https://github.com/elmbeech/physicelldataloader
    ]]></help>

    <citations>
        <citation type="bibtex">
        @misc{githubphysicelldataloader,
            author = {Bucher, Elmar},
            year = {2025},
            title = {physicelldataloader},
            publisher = {GitHub},
            journal = {GitHub repository},
            url = {https://github.com/elmbeech/physicelldataloader},
        }</citation>
    </citations>
</tool>
