<tool id="viralverify" name="viralverify" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>
        Classify contigs as viral, non-viral or uncertain, based on gene content</description>
  
    <macros>
        <import>macros.xml</import>
    </macros>
    
    <expand macro="requirements"/>

    <command detect_errors="exit_code"><![CDATA[
      mkdir output/ &&

      viralverify
      -f '$input.input_fasta'
      -o output/
      --hmm '$input.hmm_db'
      - t \${GALAXY_SLOTS:-1}
      #if "$input.plasmid_detect" == "true"#
      -p
      #end if#
      --thr '$input.threshold'

      ]]>
    </command>

    <inputs>
      <param name="input_fasta" argument="-f" type="data" format="fasta" label="Input fasta file" help="Please provide a FASTA file containing contigs to classify." />
      <param name="hmm_db" argument="--hmm" type="data" format="hmm3" label="Input hmm database" help="Please provide a HMM database file." />
      <param name="plasmid_detect" argument="-p" type="boolean" truevalue="-p" falsevalue="" checked="false" label="plasmid pred " help="if checked, plasmid detection will be enabled." />
      <param name="threshold"  argument="--thr" type="float" default="7.0" label="Sensitivity threshold" help="Minimal absolute score to classify sequence, default = 7.0" />
    </inputs>    


    <outputs> 
        <data format="csv" name="result table" label="${tool.name} on ${on_string}: result table" from_work_dir="output/*_result_table.csv" />
    </outputs>
    
    <tests>
      <param name="input_fasta" value="test.fa"/>
      <param name="hmm_db" value="test.hmm"/>
      <param name="plasmid_detect" value="false"/>
      <param name="threshold" value="7.0"/>
      <output name="result table" value="test_result_table.csv"/>
    </tests>
    <help>
<![CDATA[
required arguments:

  -f F       Input fasta file
  -o O       Output directory
  --hmm HMM  Path to HMM database

optional arguments:

  --db DB    Run BLAST on input contigs with provided database
  -t T       Number of threads
  --thr THR  Sensitivity threshold (minimal absolute score to classify
             sequence, default = 7)
  -p         Output predicted plasmids separately 
]]>
    </help>
  <citations>
    <citation type="bibtex">
@misc{viralverify2023,
  author = {Author Name},
  title = {ViralVerify: Classify contigs as viral or non-viral based on gene content},
  year = {2023},
  howpublished = {\url{https://github.com/ablab/viralVerify/}}
}
    </citation>
  </citations>
</tool>