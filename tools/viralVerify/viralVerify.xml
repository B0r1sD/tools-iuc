<tool id="viralverify"  name="viralverify"   version="24.1.4"  >
    <description>
        Classify contigs as viral, non-viral or uncertain, based on gene content</description>
    <requirements>
      <requirement type="package" version="1.1">viralverify</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
viralverify 
    -f '$input_fasta' 
    -o '$output'
    --hmm '$hmm_db' 
    #if str($blast_db) 
        --db '$blast_db' 
    #end if

    #if str($threshold)
        --thr '$threshold' 
    #end if

    '$plasmid_flag'

basename_noext="${input_fasta%.fa}"
mv "${basename_noext}_result_table.csv" result_table.csv
]]></command>
    <!-- <![CDATA[ ]]>  =  balise XML utilisée pour inclure du texte brut sans que le parseur XML ne tente de l’interpréter,  utilisée dans Galaxy pour insérer du code shell, Python, R, etc. dans une balise <command>.-->
    <inputs>
        <!-- Mandatory-->
        <param type="data" name="input_fasta" format="fasta" label="Input Fasta file"></param>
        <!-- if needed : <param type="text" name="output_dir" label="output directory path" ></param> --> 
        <param name="hmm_db" type="data" format="txt" label="HMM database file"/>
        <!-- Optionnal -->
        <param name="blast_db" type="data" format="tar" optional="true" label="Pre-built BLAST database (tar archive)"/>

        <param name="threshold" type="float" value="7.0" label="Sensitivity threshold"/>

        <param name="plasmid_flag" type="boolean" truevalue="--p" falsevalue="" label="Output predicted plasmidic contigs separately"/>
    </inputs>
    <outputs> 
          <data name="output" format="tabular"/>
    </outputs>
    <tests>
        <test>
            <param name="input_fasta" value="test.fa"/>
            
            <param name="hmm_db" value="test.hmm"/>
            <output name="result_table" file="test_result_table.csv"/>
        </test>
    </tests>
    <help>
<![CDATA[
required arguments:

  -f F       Input fasta file
  -o O       Output directory
  --hmm HMM  Path to HMM database

optional arguments:

  --db DB    Run BLAST on input contigs with provided database
  -t T       Number of threads
  --thr THR  Sensitivity threshold (minimal absolute score to classify
             sequence, default = 7)
  -p         Output predicted plasmids separately 
]]>
    </help>
  <citations>
    <citation type="bibtex">
@misc{viralverify2023,
  author = {Author Name},
  title = {ViralVerify: Classify contigs as viral or non-viral based on gene content},
  year = {2023},
  howpublished = {\url{https://github.com/ablab/viralVerify/}}
}
    </citation>
  </citations>
</tool>