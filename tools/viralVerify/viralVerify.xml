<tool id="viralverify" name="viralverify" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
   <description>
      Classify contigs as viral, non-viral or uncertain, based on gene content
   </description>
   <macros>
      <token name="@TOOL_VERSION@">1.1</token>
      <token name="@VERSION_SUFFIX@">0</token>
      <token name="@PROFILE@">23.2</token> 
   </macros>
   <requirements>
      <requirement type="package" version="@TOOL_VERSION@">viralverify</requirement>
   </requirements>
	<command detect_errors="exit_code"><![CDATA[
fasta_file='$input_fasta' &&
file_extension=\${fasta_file\#\#.} &&
ln -s '$fasta_file' contigs.\${file_extension} &&
viralverify
    -f contigs.\${file_extension}
    -o .
    --hmm '$hmm'
    --thr '$thr'
    -t \${GALAXY_SLOTS:-1}
    '$plasmid_detect'
	]]></command>
	<inputs>
       <!--MANDATORY-->
		<param name="input_fasta" type="data" format="fasta" label="Fasta file containing contigs to predict"/>
		<param name="hmm" type="data" format="hmm3" label="HMM profile"/>
      <!-- OPTIONAL-->
		<param name="plasmid_detect" type="boolean" truevalue="-p" falsevalue="" checked="false" label="plasmid prediction" help="if checked, plasmid detection will be enabled."/>
		<param name="thr" type="float" value="7.0" label="Sensitivity threshold" help="Minimal absolute score to classify sequence, default = 7.0"/>
	</inputs>    
	<outputs> 
      <data name="predicted_viral" format="fasta" label="${tool.name} on ${on_string}: Predicted viral contigs" from_work_dir="Prediction_results_fasta/*_virus.fasta"/>
		<data name="predicted_plasmid" format="fasta" label="${tool.name} on ${on_string}: Predicted plasmid contigs" from_work_dir="Prediction_results_fasta/*_plasmid.fasta"/>
		<data name="uncertain_viral" format="fasta" label="${tool.name} on ${on_string}: Uncertain viral contigs" from_work_dir="Prediction_results_fasta/*_uncertain_virus.fasta"/>
		<data name="uncertain_plasmid" format="fasta" label="${tool.name} on ${on_string}: Uncertain plasmid contigs" from_work_dir="Prediction_results_fasta/*_uncertain_plasmid.fasta"/>
 	</outputs>
	<tests>
		<test>
    		<param name="input_fasta" value="test.fa"/>
    		<param name="hmm" value="25_06_29_PF09399_reviewed_pfam_clustalo_hmmbuild.hmm"/>
    		<param name="plasmid_detect" value="false"/>
    		<output name="predicted_viral" value="output/Prediction_results_fasta/test_virus.fasta">
        		<assert_contents>
            	<has_text_matching expression="^>" />
        		</assert_contents>
    		</output>
		</test>
	</tests>
		<help>
<![CDATA[
required arguments:

	-f F       Input fasta file
	-o O       Output directory
	--hmm HMM  Path to HMM database

optional arguments:

	--db DB    Run BLAST on input contigs with provided database
	-t T       Number of threads
	--thr THR  Sensitivity threshold (minimal absolute score to classify
						 sequence, default = 7)
	-p         Output predicted plasmids separately 
]]>
		</help>
	<citations>
		<citation type="bibtex">
@misc{viralverify2023,
	author = {Author Name},
	title = {ViralVerify: Classify contigs as viral or non-viral based on gene content},
	year = {2023},
	howpublished = {\url{https://github.com/ablab/viralVerify/}}
}
		</citation>
	</citations>
</tool>
<!--[X]supprimer les sauts de lignes-->
<!--[X]mettre les argumment dans le bonne ordre-->
<!--[]faire une issue -->
<!--[]faire une section help propre-->
<!--[X]régler le problème des base hmm, checker des outils qui en utilisent-->
<!--[] redéfinir les outputs -->
<!--[X] fixer le problème de valeur par defaut du threshold-->
<!--[X]argument vs name (cf option longues)-->
<!--[]refaire test en version assert [pas fonctionnel]-->
