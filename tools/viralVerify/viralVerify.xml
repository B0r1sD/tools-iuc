<tool id="viralverify" name="viralverify" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
   <description>
      Classify contigs as viral, non-viral or uncertain, based on gene content
   </description>
   <macros>
      <token name="@TOOL_VERSION@">1.1</token>
      <token name="@VERSION_SUFFIX@">0</token>
      <token name="@PROFILE@">23.2</token> 
   </macros>
   <requirements>
      <requirement type="package" version="@TOOL_VERSION@">viralverify</requirement>
   </requirements>
	<command detect_errors="exit_code"><![CDATA[
ln -s '$input_fasta' 'contigs.fasta' &&
viralverify
    -f 'contigs.fasta'
    -o .
    --hmm '$hmm'
    --thr '$thr'
    -t \${GALAXY_SLOTS:-1}
    '$plasmid_detect'
	]]></command>
	<inputs>
       <!--MANDATORY-->
		<param name="input_fasta" type="data" format="fasta" label="Fasta file containing contigs to predict"/>
		<param argument="--hmm" type="data" format="hmm3" label="HMM profile"/>
      <!-- OPTIONAL-->
		<param name="plasmid_detect" type="boolean" truevalue="-p" falsevalue="" checked="false" label="plasmid prediction" help="if checked, plasmid detection will be enabled."/>
		<param argument="--thr" type="float" value="7.0" label="Sensitivity threshold" help="Minimal absolute score to classify sequence, default = 7.0"/>
	</inputs>    
	<outputs> 
      <data name="predicted_viral" format="fasta" label="${tool.name} on ${on_string}: Predicted viral contigs" from_work_dir="Prediction_results_fasta/contigs_virus.fasta"/>
		<data name="predicted_plasmid" format="fasta" label="${tool.name} on ${on_string}: Predicted plasmid contigs" from_work_dir="Prediction_results_fasta/contigs_plasmid.fasta"/>
		<data name="uncertain_viral" format="fasta" label="${tool.name} on ${on_string}: Uncertain viral contigs" from_work_dir="Prediction_results_fasta/contigs_uncertain_virus.fasta"/>
		<data name="uncertain_plasmid" format="fasta" label="${tool.name} on ${on_string}: Uncertain plasmid contigs" from_work_dir="Prediction_results_fasta/contigs_uncertain_plasmid.fasta"> 
		<filter>plasmid_detect == '-p'</filter>
		</data>
		<data name="chromosomal" format="fasta" label="${tool.name} on ${on_string}: Predicted chromosomal contig contigs" from_work_dir="Prediction_results_fasta/contigs_uncertain_plasmid.fasta"/>
		<data name="result_table" format="tabular" label="${tool.name} on ${on_string}: Table with contig predictions" from_work_dir="contigs.fasta"/>
 	</outputs>
	<tests>
		<test expect_num_outputs="1">
    		<param name="input_fasta" value="test.fa"/>
    		<param name="hmm" value="test.hmm"/>
    		<param name="plasmid_detect" value="false"/>
    		<output name="predicted_viral">
        		<assert_contents>
            	<has_text_matching expression="^>" />
        		</assert_contents>
    		</output>
		</test>
	</tests>
		<help>
<![CDATA[
required arguments:

	-f F       Input fasta file
	-o O       Output directory
	--hmm HMM  Path to HMM database

optional arguments:

	--db DB    Run BLAST on input contigs with provided database
	-t T       Number of threads
	--thr THR  Sensitivity threshold (minimal absolute score to classify
						 sequence, default = 7)
	-p         Output predicted plasmids separately 
]]>
		</help>
	<citations>
		<citation type="bibtex">
@misc{viralverify2023,
	author = {Author Name}, 
	title = {ViralVerify: Classify contigs as viral or non-viral based on gene content},
	year = {2023},
	howpublished = {\url{https://github.com/ablab/viralVerify/}}
}
		</citation>
	</citations>
</tool>

