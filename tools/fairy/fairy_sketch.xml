<tool id="fairy_sketch" name="Fairy sketch" version="@TOOL_VERSION@+galaxy@VERSION_SUFFIX@" profile="@PROFILE@">
    <description>sketching of k-mers for coverage into a hashtable</description>
    <macros>
        <import>macros.xml</import>
    </macros>
    <expand macro="requirements"/>
    <command detect_errors="exit_code">
        <![CDATA[

        mkdir -p res &&

        #if $input.is_select == "single":
            #set $filename = $reads.element_identifier + '.bcsp'
            ln -s '$reads' '$reads.element_identifier' &&
        #else
            #set $filename = $first_pairs.element_identifier + '.paired.bcsp'
            ln -s '$first_pairs' '$first_pairs.element_identifier' &&
            ln -s '$second_pairs' '$second_pairs.element_identifier' &&
        #end if

        fairy sketch
        -t \${GALAXY_SLOTS:-8}
        -c ${c}
        -k ${k.value}
        -d 'res'
        #if $input.is_select == "single":
            -r '$reads.element_identifier'
        #else
            -1 '$first_pairs.element_identifier'
            -2 '$second_pairs.element_identifier'
        #end if
        &&

        cp './res/${filename}' $output

        ]]>
    </command>
    <inputs>
        <conditional name="input">
            <param name="is_select" type="select" label="Single or paired-end reads">
                <option value="single">Single</option>
                <option value="pair">Paired</option>
            </param>
            <when value="single">
                <param argument="--reads" type="data" format="fastqsanger,fasta,fastq,fasta.gz,fastq.gz" label="Input single-end reads"/>
            </when>
            <when value="pair">
                <param argument="--first_pairs" type="data" format="fastqsanger,fasta,fastq,fasta.gz,fastq.gz" label="Input first paired-end reads"/>
                <param argument="--second_pairs" type="data" format="fastqsanger,fasta,fastq,fasta.gz,fastq.gz" label="Input second paired-end reads"/>
            </when>  
        </conditional>
        <param argument="-c" type="integer" value="50" optional="true" label="Set the subsampling rate"/>
        <param argument="-k" type="select" label="Select k-mer size">
            <option value="31">31</option>
            <option value="21">21</option>
        </param>
    </inputs>
    <outputs>
        <data name="output" format="bcsp" label="${tool.name} on ${on_string}"/>
    </outputs>
    <tests>
        <test>
            <conditional name="input">
                <param name="is_select" value="single"/>
                <param name="reads" value="single_test.fasta.gz" ftype="fasta.gz"/>
            </conditional>
            <output name="output" file="single_test.fasta.gz.bcsp"/>
        </test>
        <test>
            <conditional name="input">
                <param name="is_select" value="pair"/>
                <param name="first_pairs" value="test_paired_1.fq.gz" ftype="fastq.gz"/>
                <param name="second_pairs" value="test_paired_2.fq.gz" ftype="fastq.gz"/>
            </conditional>
            <output name="output" file="test_paired_1.fq.gz.paired.bcsp"/>
        </test>
    </tests>
    <help>
        <![CDATA[

        This tool sketch the k-mer into a hashtable which will be needed for the fairy coverage tool to create the coverage file.

        .. class:: infomark

            This tool can either use single-end or paired-end reads as input in multiple file formats.

            Fairy can only handle a k-mer size of 31 or 21 not more or less currently!

        ]]>
    </help>
    <expand macro="citations"/>
</tool>